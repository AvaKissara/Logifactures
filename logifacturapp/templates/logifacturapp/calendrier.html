{% extends 'base.html' %}

{% block content %}
<div class="container-md mt-4">
    <h2>Calendrier</h2>
    <div class="calendar">
        <div class="col leftCol">
            <div class="content">
                <ul class="months months-list">
                    {% for month in months %}
                        <li><a href="mois/{{ month.value }}" title="{{ month.name }}" data-value="{{ month.value }}"{% if month.selected %} class="selected"{% endif %}>{{ month.name }}</a></li>
                    {% endfor %}
                </ul>
                <div class="clearfix"></div>     
                <h1 class="date">{{ current_date }}</h1>
                <!-- Fenêtre modale agenda -->
                <div id="overlay"></div>
                <div class="popup popup-set-hour" id="popup-hour">
                    <div class="popup-content">
                        <span class="close-popup" onclick="closePopup()">&times;</span>
                        <div class="calendar-agenda">
                            <div class="timeline">
                              <div class="spacer"></div>
                              <div class="time-marker">8 : 00</div>
                              <div class="time-marker">9 : 00</div>
                              <div class="time-marker">10 : 00</div>
                              <div class="time-marker">11 : 00</div>
                              <div class="time-marker">12 : 00</div>
                              <div class="time-marker">13 : 00</div>
                              <div class="time-marker">14 : 00</div>
                              <div class="time-marker">15 : 00</div>
                              <div class="time-marker">16 : 00</div>
                              <div class="time-marker">17 : 00</div>
                              <div class="time-marker">18 : 00</div>
                            </div>
                            <div class="days">
                              <div class="day mon">
                                <div class="dates">
                                    <h2>Ajouter un événement <a href="#" id="openModal" onclick="openModal();" class="add-button-event">+</a></h2>                                   
                                </div>
                                <div class="events">
                                    {% for event in events_day %}
                                        <div class="event start-{{ event.start_datetime.hour }} end-{{ event.end_datetime.hour }}">
                                            <p class="title">{{ event.title }}
                                            {% if event.num_facture %}
                                                : {{ event.num_facture }}
                                            {% endif %}
                                            </p>
                                            <p class="time">{{ event.start_datetime|time:'H' }}:00 - {{ event.end_datetime|time:'H' }}:00</p>
                                        </div>
                                    {% endfor %}
                                </div>
                              </div>
                            </div>
                        </div>                       
                    </div>
                </div>    

                <!-- Fenêtre modale ajout event-->
                <div class="modal" id="myModalEvent">
                    <div class="modal-content">
                        <span class="close" id="closeModal" onclick="closeModal();">&times;</span>
                        <form id="eventForm" class="add-event-form">
                        <label for="eventName">Nom de l'événement:</label>
                        <input type="text" id="eventName" name="event-name" required>
                        <label for="eventName">Description de l'événement:</label>
                        <textarea id="eventDesc" name="event-desc"></textarea>
                        <label for="eventDateDeb">Heure de début :</label>
                        <div class="time-selection">
                            <select id="eventHourDeb" name="event-hour-deb" required></select>
                            <select id="eventMinDeb" name="event-min-deb" required></select>
                        </div>
                        <label for="eventDateFin">Heure de fin :</label>
                        <div class="time-selection">                       
                            <select id="eventHourEnd" name="event-hour-end" required></select>
                            <select id="eventMinEnd" name="event-min-end" required></select>
                        </div>
                        <button type="submit" class="btn btn-primary" onclick="eventFormSubmit();">Ajouter</button>
                        </form>
                    </div>
                </div>
                          
                <div class="notes">
                    <p>
                        <input type="text" value="" placeholder="Ajouter une note" id="note-input"/>
                        <a href="#" title="Ajouter une note" class="addNote animate" onclick="openPopup()">+</a>
                    </p>
                    <ul class="noteList">
                    {% for event in events_day %}
                        <li>
                            {{ event.title }} :
                            {% if event.num_facture %}
                                 {{ event.num_facture }}
                            {% else %}
                                {{ event.start_datetime|time:"H:i" }} - {{ event.end_datetime|time:"H:i" }}
                            {% endif %}
                        </li>
                    {% endfor %}
                    </ul>
                </div>
                <div class="clearfix"></div>                
            </div>
        </div>

        <div class="col rightCol">
            <div class="content">
                <h2 class="year">2024</h2>               
                   <!-- Logique pour les jours de la semaine -->
                   <ul class="weekday">
                    {% for day in days_of_week %}
                        <li><a href="#" title="{{ day }}" data-value="{{ day }}">{{ day }}</a></li>
                    {% endfor %}
                </ul>
                <div class="clearfix"></div>

                <!-- Logique pour les jours du mois -->
                <ul class="days days-list">
    {% for day in days_of_month %}
        <li>
            <a href="jour/{{day.month}}/{{ day.day }}" title="{{ day.day }}" data-value="{{ day.day }}" {% if day.month != selected_month %}class="other-month"{% endif %} {% if not day.day %}class="hide-day"{% endif %}>
                {{ day.day }}
                {% if day in events_date %}
                    <span class="event-indicator">X</span>
                {% endif %}                           
            </a>
        </li>
    {% endfor %}
</ul>

            </div>
        </div>
        <div class="clearfix"></div>
    </div>
</div>
{% endblock %}
